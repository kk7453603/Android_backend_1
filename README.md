# Auth Service API - README

Этот README описывает, как запустить сервис аутентификации в Docker и использовать Swagger для взаимодействия с API.

## Оглавление

- [Запуск через Docker](#запуск-через-docker)
- [Переменные окружения](#переменные-окружения)
- [Доступ к Swagger](#доступ-к-swagger)
- [Использование API](#использование-api)
- [Описание Роутов](#описание-роутов)

## Запуск через Docker

Для запуска сервиса используйте Docker Compose. Убедитесь, что у вас установлен Docker и Docker Compose.

1. Склонируйте репозиторий:

2. Убедитесь, что `.env` файл настроен верно (см. раздел [Переменные окружения](#переменные-окружения)).

3. Запустите сервис с помощью Docker Compose:

4. Сервис будет доступен по адресу: [http://localhost:8000](http://localhost:8000).

## Переменные окружения

Для настройки сервиса используется файл `.env`, в котором необходимо указать следующие переменные окружения:

- `SECRET`: Секретный ключ для подписи JWT-токенов.
- `DEBUG`: Включение режима отладки (`on` или `off`).
- `DB_MIGRATIONS_PATH`: Путь к миграциям базы данных.
- `DB_NAME`, `DB_USER`, `DB_PASSWORD`, `DB_PORT`, `DB_HOST`: Настройки подключения к базе данных PostgreSQL.
- `Service_Url`: URL для запуска сервиса.

## Доступ к Swagger

После запуска сервиса вы можете получить доступ к Swagger UI для тестирования API по адресу:

[http://localhost:8000/swagger/index.html](http://localhost:8000/swagger/index.html)

Swagger UI предоставляет удобный интерфейс для взаимодействия с API, а также позволяет вводить JWT-токены для авторизации.

## Использование API

### Авторизация через JWT

Для взаимодействия с защищёнными эндпоинтами, сначала необходимо получить JWT-токен. Токен передаётся в заголовке `Authorization` в формате:

Используйте Swagger UI для генерации и использования токенов, или делайте запросы через инструменты вроде Postman.

## Описание Роутов

### 1. Создание токенов (`/api/createToken`)

- **Метод**: `POST`
- **Описание**: Генерирует новые Access и Refresh токены для пользователя.
- **Тело запроса**:
- **Успешный ответ** (код 200):

### 2. Обновление токенов (`/api/updateToken`)

- **Метод**: `POST`
- **Описание**: Обновляет Access и Refresh токены, используя текущий Refresh токен.
- **Параметры**:
  - `refresh_token` (в теле запроса).
- **Успешный ответ** (код 200):

### 3. Регистрация пользователя (`/api/user/register`)

- **Метод**: `POST`
- **Описание**: Регистрирует нового пользователя с использованием email, пароля и никнейма.
- **Тело запроса**:
- **Успешный ответ** (код 200):

### 4. Изменение пароля (`/api/user/changePassword`)

- **Метод**: `POST`
- **Описание**: Позволяет аутентифицированному пользователю изменить пароль.
- **Тело запроса**:
- **Успешный ответ** (код 200):
- **Требуется авторизация**: Да, необходимо добавить JWT-токен в заголовок `Authorization`.

## Логи и Отладка

- Логи приложения будут выводиться в консоль. Если включён режим отладки (`DEBUG=on`), будут выводиться дополнительные отладочные сообщения.
- Логи Postgres также будут доступны в Docker контейнере Postgres.

## Завершение работы

Чтобы остановить сервис, выполните команду:

Это завершит работу всех контейнеров и освободит ресурсы.

## Возможные ошибки и решения

### Ошибка: `missing or malformed jwt`

- **Причина**: В запросе отсутствует JWT-токен или он передан в неправильном формате.
- **Решение**: Убедитесь, что вы передаёте токен в заголовке `Authorization` в формате `Bearer <ваш_JWT_токен>`.

### Ошибка подключения к базе данных

- **Причина**: Postgres контейнер может быть недоступен.
- **Решение**: Убедитесь, что контейнер базы данных работает и имеет правильные параметры для подключения.